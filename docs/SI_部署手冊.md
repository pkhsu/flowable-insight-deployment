# Flowable Insight ETL éƒ¨ç½²æ‰‹å†Š
## å·¥å»  SI äººå“¡æ“ä½œæŒ‡å— (v2.1)

> **é©ç”¨å°è±¡**: è² è²¬éƒ¨ç½²æ­¤ç³»çµ±çš„ç³»çµ±æ•´åˆ (SI) äººå“¡  
> **é è¨ˆæ™‚é–“**: ç´„ 15-30 åˆ†é˜  
> **é›£åº¦ç­‰ç´š**: â˜…â˜†â˜†â˜†â˜† æ¥µç°¡
> **æ¶æ§‹**: Single VM Deployment (No Airbyte)

---

## ğŸ“‹ éƒ¨ç½²å‰æº–å‚™

### æ‚¨éœ€è¦æº–å‚™çš„è³‡è¨Š

åœ¨é–‹å§‹ä¹‹å‰ï¼Œè«‹å…ˆå–å¾—ä»¥ä¸‹è³‡è¨Šï¼š

| é …ç›® | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| **Harbor æ†‘è­‰** | å…¬å¸æ˜ åƒæª”åº«çš„å¸³å¯† | å¸³: `deployer` |
| **MSSQL é€£ç·š** | ERP ç³»çµ±çš„ IPã€å¸³å¯†ã€è³‡æ–™åº«åç¨± | `192.168.1.100`, `sa` |
| **VM ç™»å…¥æ¬Šé™** | Ubuntu Server çš„å­˜å–æ¬Š | IP: `10.0.1.10` |

### ç³»çµ±éœ€æ±‚

- **1 å° Ubuntu ä¼ºæœå™¨** (32GB RAM / 500GB SSD)
- Docker èˆ‡ Docker Compose å·²å®‰è£
- å¯é€£ç·šè‡³ Harbor æ˜ åƒæª”åº«
- å¯é€£ç·šåˆ° MSSQL è³‡æ–™åº« (Port 1433)

---

## ğŸš€ éƒ¨ç½²æµç¨‹

### æ­¥é©Ÿ 1ï¼šå–å¾—å®‰è£åŒ…ä¸¦è§£å£“

ç™»å…¥ç›®æ¨™ VMï¼Œä¸‹è¼‰ç”± GitLab CI ç·¨è­¯å¥½çš„ç™¼å¸ƒåŒ…ï¼š

```bash
cd /opt

# ä¸‹è¼‰ç™¼å¸ƒåŒ… (è«‹æ›¿æ›ç‚ºæ‚¨ GitLab çš„ Artifact ä¸‹è¼‰é€£çµ)
# æˆ–è€…ç”±å·¥ç¨‹å¸«æ‰‹å‹•ä¸Šå‚³ flowable-insight-deploy.tar.gz
wget <GITLAB_ARTIFACT_URL> -O flowable-insight-deploy.tar.gz

# è§£å£“ç¸®
tar -xzvf flowable-insight-deploy.tar.gz
cd flowable-insight
```

è§£å£“å¾Œçš„ç›®éŒ„çµæ§‹ï¼š
```text
/opt/flowable-insight/
â”œâ”€â”€ .env.example         <- è¦è¤‡è£½ç‚º .env ä¸¦å¡«å¯«
â”œâ”€â”€ docker-compose.yml   <- æœå‹™é…ç½®
â”œâ”€â”€ flowable-ctl.sh      <- ç®¡ç†è…³æœ¬
â”œâ”€â”€ config/cube/         <- Cube.js è³‡æ–™æ¨¡å‹
â””â”€â”€ backup/              <- å‚™ä»½å·¥å…·
```

### æ­¥é©Ÿ 2ï¼šç™»å…¥ Harbor

```bash
docker login harbor.company.local
# è¼¸å…¥æ‚¨çš„ Harbor å¸³è™Ÿèˆ‡å¯†ç¢¼
```

### æ­¥é©Ÿ 3ï¼šè¨­å®šç’°å¢ƒè®Šæ•¸

```bash
# è…³æœ¬é¦–æ¬¡åŸ·è¡Œæ™‚æœƒè‡ªå‹•å¾ .env.example å»ºç«‹ .env
# æˆ–è€…æ‚¨å¯ä»¥æ‰‹å‹•è¤‡è£½:
cp .env.example .env

# ç”¢ç”Ÿ Cube.js API é‡‘é‘° (è¤‡è£½è¼¸å‡ºçš„é•·å­—ä¸²)
openssl rand -hex 32

# ç·¨è¼¯è¨­å®šæª”
nano .env
```

`.env` è£¡é¢æœ‰æ¸…æ¥šçš„ä¸­æ–‡æ¨™ç¤ºï¼Œè«‹å¡«å¯«æ‰€æœ‰æ¨™è¨˜ âœï¸ çš„æ¬„ä½ï¼š
- **Harbor è¨­å®š**: å…¬å¸çš„ Harbor åœ°å€èˆ‡å°ˆæ¡ˆåç¨±
- **MSSQL è¨­å®š**: ERP è³‡æ–™åº«çš„ IPã€å¸³è™Ÿã€å¯†ç¢¼
- **ClickHouse å¯†ç¢¼**: è¨­å®šä¸€çµ„è¤‡é›œå¯†ç¢¼
- **Cube.js API é‡‘é‘°**: è²¼ä¸Šå‰›å‰›ç”¢ç”Ÿçš„éš¨æ©Ÿå­—ä¸²

### æ­¥é©Ÿ 4ï¼šä¸€éµå•Ÿå‹•

```bash
chmod +x flowable-ctl.sh
./flowable-ctl.sh start
```

è…³æœ¬æœƒè‡ªå‹•ï¼š
1. å¾ Harbor æ‹‰å–æœ€æ–°æ˜ åƒæª”
2. å»ºç«‹ `data/clickhouse/` å’Œ `data/cubestore/` è³‡æ–™ç›®éŒ„
3. å•Ÿå‹•æ‰€æœ‰æœå‹™ä¸¦åŸ·è¡Œå¥åº·æª¢æŸ¥

çœ‹åˆ°å››å€‹ âœ… å°±ä»£è¡¨éƒ¨ç½²æˆåŠŸï¼

```
  ClickHouse (8123): âœ… å¥åº·
  CubeStore  (3030): âœ… é‹è¡Œä¸­
  Cube.js    (4000): âœ… å¥åº·
  BFF API    (8050): âœ… å¥åº·
```

---

## ğŸ’¾ è¨­å®šè‡ªå‹•å‚™ä»½ (é¸é…)

```bash
# 1. åœ¨ .env ä¸­å¡«å¯« S3 Bucket è³‡è¨Š
# 2. è¨­å®š AWS æ†‘è­‰
aws configure

# 3. å®‰è£æ¯æ—¥è‡ªå‹•å‚™ä»½æ’ç¨‹
cd backup
sudo bash setup-backup-cron.sh
```

---

## ğŸ”§ æ—¥å¸¸ç¶­è­·

| æ“ä½œ | æŒ‡ä»¤ |
|------|------|
| å•Ÿå‹•æœå‹™ | `./flowable-ctl.sh start` |
| åœæ­¢æœå‹™ | `./flowable-ctl.sh stop` |
| é‡å•Ÿæœå‹™ | `./flowable-ctl.sh restart` |
| å¥åº·æª¢æŸ¥ | `./flowable-ctl.sh health` |
| æŸ¥çœ‹æ—¥èªŒ | `./flowable-ctl.sh logs` |
| æŸ¥çœ‹ç‹€æ…‹ | `./flowable-ctl.sh status` |

### å¸¸è¦‹å•é¡Œ

**Q: æ˜ åƒæª”æ‹‰ä¸ä¸‹ä¾†ï¼Ÿ**
â†’ è«‹åŸ·è¡Œ `docker login harbor.company.local` ç¢ºèªå¸³å¯†ã€‚

**Q: ClickHouse ç„¡æ³•å•Ÿå‹•ï¼Ÿ**
â†’ è«‹ç¢ºèª VM å¯ç”¨è¨˜æ†¶é«” â‰¥ 22GBï¼Œä¸¦åŸ·è¡Œ `./flowable-ctl.sh logs clickhouse-server` æª¢æŸ¥éŒ¯èª¤ã€‚

---

**æ–‡ä»¶ç‰ˆæœ¬**: 2.1  
**è®Šæ›´è¨˜éŒ„**: ä¿®æ­£ç›®éŒ„çµæ§‹å°é½Š Release Artifact æ‰å¹³ç›®éŒ„ã€‚
